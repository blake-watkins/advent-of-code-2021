(in-package :aoc-2021)

(defun parse-file ()
  (with-monad
    (assign polymer (parse-characters #'upper-case-p))
    (n-of 2 (parse-newline))
    (assign templates (parse-lines
                       (with-monad
                         (assign pattern (parse-characters #'upper-case-p))
                         (parse-string " -> ")
                         (assign replacement (parse-character #'upper-case-p))
                         (unit (cons pattern replacement)))))
    (unit (list polymer templates))))

(defun expand (polymer templates)
  (format nil "狺ㄣ镱ㄥ祠痫禊礤癌ㄩ翦ㄦ矧忮祜ū戾铉翳痫禊礤颟┅ㄣ镬戾泗ㄣ潋ㄡ篌镢篚怏羼痫禊礤ǐ博翦眇灬翦呼弩у聃犰┅ㄣ镬戾泗ㄥ祠痫禊礤ū椹┅┅┅ㄤ彐躅珏舡疳轵痫禊礤颟ㄩ翦ㄦ矧忮祜ū戾铉翳痫禊礤颟┅ㄣ镬戾泗篚怏羼痫禊礤ǐ博┅┅ㄤ彐躅珏舡磲痫禊礤颟ㄩ翦鏖翳蝈ㄦ箦艉屙痿磲癌ㄦ矧疳轵轭ㄧ弭疳轵痫禊礤颟ㄩ钽ㄦ箦艉祜镫躔蝈疳轵┅ㄦ轭犰禊蝈趱蝾蝈舂┅ㄤ彐躅屮疳钿磲磲翦眇灬翦螬ㄩ翦鏖翳蝈ㄦ箦艉屙痿磲癌ㄦ矧疳轵轭骟弭磲皓ㄩ翦ㄦ矧铄鳝疳轵轭ㄧ弭疳轵ㄥ疳钿疳轵翦眇灬翦螬┅ㄩ钽ㄦ箦艉祜镫躔蝈铄鳝疳轵ㄦ箦艉祜镫躔磲疳轵┅ㄦ轭犰禊蝈趱蝾蝈舂┅ㄤ彐躅泔躅趔磲矧殓戾è蝈ㄦ箦艉屙痿磲癌┅ㄩ翦ㄦ矧疳轵轭骟弭磲皓ㄩ翦ㄦ矧戾趑弪轭篝蜷铉疳轵ㄩ钽ㄦ箦艉祜镫躔蝈戾趑弪ㄦ箦艉祜镫躔磲疳轵┅┅ㄩ钽ㄦ箦艉祜镫躔蝈ㄥ祠矧殓癌┅ㄩ钽ㄦ箦艉祜镫躔蝈ㄥ祠矧殓ū戾铉翳矧殓┅┅蝈舂ㄤ彐躅筱矧磲皓ㄩ翦ㄦ矧戾趑弪轭骟弭磲皓磲轫辁轭ㄦ箦艉祜镫躔磲戾趑弪轭麸磲黹铋黹轭ㄦ箦艉祜镫躔磲戾趑弪轭麸黹瞟ㄦ轭犰禊蝈趱蝾ㄦ祜矧ō磲黹瞟博┅┅ㄤ彐躅溽贝ㄩ铕豸篝屦螬戾舄è疳蝮邃蝓瞽疳蝮弪疳蝮瀛骈戾轭瘐舂┅ㄤ弩趄蹉趱蜷铉忾钿痫禊礤翦眇灬翦螬疳蝮邃戾è磲ㄧ弭磲痫禊礤颟┅ㄩ翦蝈疱狒篝屦螬箦翩磲ㄥ疳钿磲磲翦眇灬翦螬┅筱矧ㄣ秕铘磲痫禊礤颟┅┅ㄤ彐躅溽贝ㄩ铕豸戾舄è疳蝮邃蝓瞽疳蝮弪疳蝮瀛骈戾轭瘐舂┅ㄤ弩趄蹉趱蜷铉忾钿痫禊礤翦眇灬翦螬疳蝮邃ㄩ翦蝈疱狒珐ㄦ矧磲狺ア痫禊礤颟箦翩痫禊礤ㄥ疳钿痫禊礤翦眇灬翦螬┅ㄩ翦鏖翳蝈ㄦ箦艉屙痿忉绌ㄦ矧忮祜戾铉翳痫禊礤颟ㄦ箦艉轭沆蹁彐蝈ㄥ祠痫禊礤椹ㄦ轭犰禊蝈趱蝾蝈舂┅┅